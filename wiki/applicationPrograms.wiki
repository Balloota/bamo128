#summary bamo128 and arduino sketches or C/C++/asm - application programs

You can upload application programs bamo128 from the arduino IDE or with the 'w' and 'W' - command from monitor. Programs are loaded at flash address 0 normally.<br>
This programs overwrite the interrupt vector table at address 0 and if you activate the timer1 in "mainloop.asm" the system crashes. <br>
It crashes also, if you use the monitor 's' (step) or 'x'(start with breakpoint because it is realized with time2 interrupt.<br>
But you can avoid this, if you in your C/C++/Arduino-sourcecode insert this lines (for atmega1280 or atmega328):<br>
{{{
#define	BYTES(word)	((word)*2)
#define	STRING(a,b)	#a" "#b
#define	INLINEASM(a,b)	STRING(a,b)

#ifdef  __AVR_ATmega1280__		// arduinoMega
#define	LARGEBOOTSTART	0xf000
#define	BOARDRAMEND	0x2200
#define	MONSTART	LARGEBOOTSTART
#elif __AVR_ATmega328P__		// arduinoDuemilanove
#define	LARGEBOOTSTART	0x3000
#define	BOARDRAMEND	0x900
#define	MONSTART	LARGEBOOTSTART
#endif	
#define MONRAM		(BOARDRAMEND-0x100)
#define	SYSTIMEMILLISEC	(MONRAM+0x40)
#define saveCPU		BYTES(LARGEBOOTSTART+62)	// time2Comp interrupt
#define mySysClock      BYTES(LARGEBOOTSTART+56)	// timer1 overflow int

// monitor interrupt f√ºr step ...
ISR(TIMER2_COMPA_vect) __attribute__ ((naked));
ISR(TIMER2_COMPA_vect) {asm volatile  (INLINEASM(jmp,saveCPU));}

 /* monitor interrupt for sysclock millisec */
ISR(TIMER1_COMPA_vect) __attribute__ ((naked));
ISR(TIMER1_COMPA_vect) {asm volatile  (INLINEASM(jmp,mySysClock));}
}}}
In asm set equivalent jump entries for interrupts with '.org' pseudo code directives.<br>
The monitor needs 256 bytes ram. Sketches/C/C++ programs use the whole ram with the stacksegment in the upper part normally. You can  
{{{
void code_init2() __attribute__ ((naked, section (".init2")));

/* !!! never call this function !!! */
void code_init2 (void)
{
#ifdef __AVR_ATmega1280__		// arduinoMega
   SP = 0x2100;
#elif __AVR_ATmega328P__		// arduinoDuemilanove
   SP = 0x800; 
#endif
}
}}}
an equivalent effect you get with a linker option:<br>
-Wl,--defsym=__stack=0x8003ff<br>

=== Use of monitor functions and variables in application programs===
The monitor contains useful variables and functions how currentImeMilliSec
or conIn and conOut, the serial byte input and output.<br>
You can use many in your application program.<br>
Most public functions are C/C++ compatible (parameter passing, return value, use of registers,...).<br>
Your sketch, C/C++ or asm program must make known this.<br>
#define	SYSTIMEMILLISEC	(MONRAM+0x40)